# 第5周周记 - 2026-02-12

**日期：** 2026年2月12日  
**主题：** 项目环境初始化与依赖管理

---

## 本周工作概述

这周主要完成了项目的基础环境搭建，把之前零散的配置统一规范了。包括 Git 仓库初始化、依赖版本锁定，以及 UV 虚拟环境的建立。目标是让环境配置可复现，方便后续在内网机器上部署。

---

## 具体工作内容

### 1. Git 仓库初始化

把项目做成了 Git 仓库，但还没设远端。现在可以在本地做版本管理了，后续如果推到公司 GitLab 再加 remote。

**相关文件：**
- `.git/` - 新初始化的仓库
- 当前无远端配置

### 2. 依赖管理规范化

对照 `one_model` 仓库的风格，把依赖声明统一成了固定版本格式（`==` 而不是 `>=`）。

**具体改动：**
- `requirements.txt`：从松散约束改成精确版本锁定
- `setup.py`：`install_requires` 同步更新
- `pyproject.toml`：`project.dependencies` 同步更新

**版本列表（共15个）：**
- torch==2.0.0
- torchvision==0.15.0  
- numpy==1.21.0
- pillow==9.0.0
- tqdm==4.65.0
- plyfile==0.8.0
- imageio==2.9.0
- imageio-ffmpeg==0.4.0
- lpips==0.1.4
- scikit-learn==1.0.0
- scipy==1.7.0
- tensorboard==2.10.0
- matplotlib==3.5.0
- trimesh==3.15.0（可选但推荐）
- open3d==0.16.0（可选但推荐）

### 3. UV 虚拟环境搭建

用 UV 重建了虚拟环境，指定 Python 3.10（因为之前默认建出来是 3.13，很多老包不支持）。

**环境信息：**
- 环境路径：`.venv/`
- Python 版本：3.10.19
- 管理工具：uv 0.9.9
- 激活命令：`source .venv/bin/activate`

**注：** 目前环境是空的（未安装任何包），方便后续从内网源完整安装。

### 4. 内网源配置准备

确认了公司内网 PyPI 源的使用方式：
- 源地址：`http://artifactory.intra.xiaojukeji.com/artifactory/api/pypi/pypi/simple`
- 安装时需要加 `--trusted-host` 参数

---

## 遇到的问题与思考

1. **版本兼容问题**  
   一开始 UV 默认建了 Python 3.13 的环境，但 torch==2.0.0 这些老版本不支持 3.13，只能降到 3.10。这说明锁定老版本依赖的同时也要注意 Python 版本上限。

2. **依赖同步维护**  
   这个项目同时有 `requirements.txt`、`setup.py`、`pyproject.toml` 三处声明，之前各自为政容易不一致。现在统一成一样的内容，但后续如果修改要记得三处一起改。

3. **内网 vs 开源源**  
   看了下 `one_model` 的 requirements，里面有很多 `@ file:///...` 的本地路径，这种在其他机器装不了。我们现在的方案是保持可移植的版本号格式，安装时再指定内网源，两边都能用。

---

## 下周计划

1. **实际安装依赖**  
   从内网源完整安装 `requirements.txt` 里的包，验证是否都能正常下到指定版本。

2. **编译 CUDA 子模块**  
   `submodules/diff_gaussian_rasterization` 是 CUDA 加速的光栅化器，需要编译才能用。

3. **跑通渲染流程**  
   用 `output/` 目录下已有的训练结果测试渲染，确认环境配置正确。

---

## 技术备忘

```bash
# UV 环境操作
uv venv --python 3.10 .venv              # 创建/重建环境
source .venv/bin/activate                # 激活环境
uv run python xxx.py                     # 不激活直接运行（推荐）

# 内网源安装（待执行）
uv pip install -r requirements.txt \
  --index-url http://artifactory.intra.xiaojukeji.com/artifactory/api/pypi/pypi/simple \
  --allow-insecure-host artifactory.intra.xiaojukeji.com
```
